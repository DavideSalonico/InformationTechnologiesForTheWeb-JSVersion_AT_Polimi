<!DOCTYPE html>
<html lang="it" dir="ltr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1">
    <title>Vendita</title>
    <link rel="icon" th:href="@{/img/icon.png}">
    <!-- 3 css, uno per lo stile generico delle pagine, il secondo solo per l'immagine di sfondo, il terzo per i dettagli relativi alle tabelle-->
    <link rel="stylesheet" type="text/css" th:href="@{/css/main.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/sell.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/auctionOffer.css}">
</head>
<body>
    <p th:remove="all">Questa è una pagina dinamica, viene generata a runtime, non è previsto un accesso diretto!</p>
    <div class="col lft-col">
        <div class="quick-nav">
            <h3>Navigazione Rapida</h3>
            <ul>
                <!-- gli href rendono rapida la navigazione all'interno della pagina portando il client direttamente alle zone interessate -->
                <li><a href="#open-auc">Aste Aperte</a></li>
                <li><a href="#closed-auc">Aste Chiuse</a></li>
                <li><a href="#create-auc">Crea Asta</a></li>
            </ul>
        </div>
    </div>
    <div class="col mid-col">

        <div class="row first-row auc-list">
            <h2 id="open-auc">Aste Aperte</h2>
            <p th:if="${userOpenAuctions.isEmpty()}">No open auction open found, Create some new Auctions! </p>

            <!-- Chiamo il metodo showAuction() all'interno della pagina fragments.html che mi mostrerà tutte le aste aperte perchè gli passo userOpenAuctions,
             mentre l' 1 è il parametro che servirà al metodo per capire se siamo nelle aste aperte o chiuse-->
            <section th:replace="~{WEB-INF/fragments.html :: showAuctions (${userOpenAuctions}, 1)}"></section>
        </div>

        <div class="row second-row auc-list">
            <h2 id="closed-auc">Aste Chiuse</h2>
            <p th:if="${userClosedAuctions.isEmpty()}">There aren't any closed AUCTIONS !</p>

            <!-- Chiamo il metodo showAuction() all'interno della pagina fragments.html che mi mostrerà tutte le aste chiuse perchè gli passo userClosedAuctions,
            mentre lo 0 è il parametro che servirà al metodo per capire se siamo nelle aste aperte o chiuse-->
            <section th:replace="~{WEB-INF/fragments.html :: showAuctions (${userClosedAuctions}, 0)}"></section>
        </div>

        <div class="row third-row form">
            <h2 id="create-art">CREATE A NEW ARTICLE</h2>
            <!-- Form che permette l'inserimento di nuovi articoli, chiama la servlet /CreateArticle che renderizzerà nuovamente questa pagina con l'articolo aggiunto -->
            <form th:method="post" th:action="@{/CreateArticle}" enctype="multipart/form-data">

                <!-- La servlet riceverà i parametri mandati dal form nella sua doPost(), la quale accederà ad essi tramite gli identificatori "name" -->
                <div>
                    <label for="name">Article's Name:</label>
                    <input type="text" name="name" id="name" min="4" max="50" required>
                </div>
                <div>
                    <label for="description">Description:</label>
                    <textarea name="description" id="description" rows="4" cols="50" minlength="20" maxlength="3000" placeholder=" ..." spellcheck="false" required></textarea>
                </div>
                <div>
                    <label for="price">Price:</label>
                    <input type="number" name="price" id="price" min="1" step="1" max="700000000" required>
                    <span> &euro;</span>
                </div>
                <div>
                    <label for="image">Select an image:</label>
                    <input type="file" accept="image/png, image/gif, image/jpeg" name="image" id="image"  required>
                </div>
                <button name="article-submit" type="submit">Create Article</button>
            </form>
        </div>

        <div class="row fourth-row form">
            <h2 id="create-auc">CREATE A NEW AUCTION</h2>

            <!-- Form che scatena la doGet() nella servlet /GoToSell, servirà a ri-renderizzare la pagina con le aggiunte degli articoli selezionati  -->
            <form th:method="GET" th:action="@{/GoToSell}">

                <!-- Necessità di mantenere dei parametri nascosti che tengano traccia di tutti gli articoli selezionati, per non renderli più disponibili nella selezione  -->
                <input type="hidden"  th:each="article : ${articlesSelected}" th:value="${article.article_id}" name="alreadySelected"></input>
                <div style="display: flex;"> <!-- Flexbox per allineare i due div per aggiungere articoli -->
                    <div style="flex: 1;">
                        <div th:if="${not articles.isEmpty()}">
                            <label for="articleSelected">Article</label>
                            <select name="articleSelected" id="articleSelected" >
                                <!-- Mostra tutti gli articoli creati dal client non ancora assegnati ad alcuna asta -->
                                <option th:each="article : ${articles}" th:value="${article.article_id}" th:text="${article.name}"></option>
                            </select><br/>

                            <button name="auction-submit" type="submit">Aggiungi all'Asta</button>
                        </div>
                        <div th:unless="${not articles.isEmpty()}">
                            <!-- Versione statica della pagina -->
                            <p>First of all, create some new ARTICLES !</p>
                        </div>
                    </div>

                    <!-- Riquadro che mostra al client quali articoli stia aggiungendo all'asta in fase di creazione -->
                    <div style="flex: 1;" th:if="${!articlesSelected.isEmpty()} ">
                        <h2>List of Articles selected :</h2>
                        <table>
                            <thead>
                                <tr>
                                    <th>NAME</th>
                                    <th>CODE</th>
                                    <th>PRICE</th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr th:each="article : ${articlesSelected}">
                                    <td th:text="${article.name}"></td>
                                    <td th:text="${article.article_id}"></td>
                                    <td th:text="${article.price}"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div style="flex: 1;" th:unless="${!articlesSelected.isEmpty()}">
                        <h2>NO ARTICLES SELECTED :</h2>
                    </div>
                </div>
            </form>

            <!-- Form che scatena la doPost() della servlet CreateAuction, prende in input tutti gli attributi di un'asta e la crea -->
            <form action="#" th:action="@{/CreateAuction}" method="post" enctype="multipart/form-data">
                <div>
                    <label for="minimum_raise"> Minimum Raise:</label>
                    <input type="number" name="minimum_raise" id="minimum_raise" min="5" step="1" max="100000" required>
                    <span> &euro;</span>
                </div>
                <div>
                    <label for="expiring_date">Expiring Date : </label>
                    <input type="datetime-local" name="expiring_date" id="expiring_date" th:min="${ldt}" placeholder="yyyy-MM-ddTHH:mm" th:value="${ldt}" required>
                </div>

                <!-- Necessità di mantenere dei parametri nascosti che tengano traccia di tutti gli articoli selezionati per poterli aggiungere all'asta da creare  -->
                <input type="hidden"  th:each="article : ${articlesSelected}" th:value="${article.article_id}" name="articlesSelected" ></input>
                <button type="submit">Crea Asta</button>
            </form>
        </div>
    </div>
    <div class="col rgt-col">
        <div class="quick-nav menu">
            <h3>Menu</h3>
            <ul>
                <li><a th:href= "@{/GoToHome}">Home</a></li>
                <li><a th:href="@{/GoToPurchase}">Purchase</a></li>
                <li><a th:href="@{/GoToSell}">Sell</a></li>
                <li><a th:href= "@{/Logout}">Logout</a></li>
            </ul>
        </div>
    </div>
</body>
</html>





