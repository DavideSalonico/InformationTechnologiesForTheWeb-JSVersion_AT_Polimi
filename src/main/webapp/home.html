<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
    <meta charset="ISO-8859-1">
    <title>Online Auctions</title>
    <link rel="stylesheet" type="text/css" href="css/main.css">
    <link rel="stylesheet" type="text/css" href="css/home.css">
    <link rel="stylesheet" type="text/css" href="css/sell.css">
    <link rel="stylesheet" type="text/css" href="css/auctionOffer.css">
    <link rel="stylesheet" type="text/css" href="css/purchase.css">
    <link rel="stylesheet" type="text/css" href="css/auctionDetails.css">
    <link rel="stylesheet" type="text/css" href="css/offer.css">
    <link rel="stylesheet" type="text/css" href="css/dettagli.css">
    <script src="utils.js" charset="utf-8" defer></script>
    <script src="onlineAuctions.js" charset="utf-8" defer></script>
</head>
<body>
    <div class="col mid-col introduction">
        <div id="id_alert"></div>

        <div id="id_loginBanner" class="overview" >
            <div>
                <h2>Online Auctions!</h2>
                <p id="id_username">Welcome back </p>
                <p><strong>
                    Welcome to our online auction page, where treasures await and bidding is an adventure. Explore our curated selection of unique items from around the world, spanning art, antiques, jewelry, and more. Join the excitement, place your bids, and discover extraordinary pieces that will capture your heart. Happy bidding!</strong></p>
                <h2>Privacy Policy</h2>
                <p>Your privacy is of utmost importance to us. We are committed to protecting and safeguarding your personal information while ensuring a secure and transparent auction experience. Rest assured that any data you provide will be handled in accordance with our strict privacy policy, ensuring confidentiality and respect for your privacy at all times</p>
            </div>
        </div>

        <div class="id_sellPage">
            <!-- ASTE APERTE -->
            <div class="row first-row auc-list"  >
                <h2>Open Auctions</h2>
                <section id="openAuctions">
                    <p>No open auctions found, create some new Auctions! </p>
                    <section class="scrollable" >
                        <a>
                            <table class="dtl-offers">
                                <thead>
                                <tr>
                                    <th>Article Name</th>
                                    <th>Code</th>
                                    <th>Price</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <!-- Table Content-->
                                </tbody>
                            </table>
                            <p>
                                <span></span> &euro;
                            </p>
                            <!-- PUT Offerte massima e Remaining Times by Script-->
                        </a>
                    </section>
                </section>
            </div>
            <!-- ASTE CHIUSE -->
            <div class="row second-row auc-list" >
                <h2>Closed Auctions</h2>
                <section id="closeAuctions">
                    <p>No closed auctions found, create some new Auctions! </p>
                    <section class="scrollable" >
                        <a>
                            <table class="dtl-offers">
                                <thead>
                                <tr>
                                    <th>Article Name</th>
                                    <th>Code</th>
                                    <th>Price</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <!-- Table Content-->
                                </tbody>
                            </table>
                            <p>
                                <span></span> &euro;
                            </p>
                            <!-- PUT Offerte massima e Remaining Times by Script-->
                        </a>
                    </section>
                </section>
            </div>
            <!-- CREATE ARTICLE -->
            <div id="createArticle" class="row third-row form">
                <h2>CREATE A NEW ARTICLE</h2>
                <form method="post" action="@{/CreateArticle}" enctype="multipart/form-data">
                    <div>
                        <label for="name">Article's Name:</label>
                        <input type="text" name="name" id="name" min="4" max="255" required>
                    </div>
                    <div>
                        <label for="description">Description:</label>
                        <textarea name="description" id="description" rows="4" cols="50" minlength="10" maxlength="255" placeholder=" ..." spellcheck="false" required></textarea>
                    </div>
                    <div>
                        <label for="price">Price:</label>
                        <input type="number" name="price" id="price" min="1" step="1" max="1000000000" required>
                        <span> &euro;</span>
                    </div>
                    <div>
                        <label for="image">Select an image:</label>
                        <input type="file" accept="image/*" name="image" id="image"  required>
                    </div>
                    <button name="article-submit" type="submit">Create Article</button>
                </form>
            </div>
            <!-- CREATE AUCTION -->
            <div class="row fourth-row form">
                <h2 id="create-auc">CREATE A NEW AUCTION</h2>

                <!-- Form that triggers the doGet () in the servlet / GoToSell, it will be used to re-render the page with the additions of the selected articles -->
                <form method="GET" action="@{/GoToSell}">

                    <!-- Necessary to keep hidden parameters that keep track of all the selected articles, so as not to make them available again in the selection -->
                    <input type="hidden"  each="article : ${articlesSelected}" value="${article.article_id}" name="alreadySelected">
                    <div style="display: flex;"> <!-- Flexbox per allign the two divs to insert articles -->
                        <div style="flex: 1;">
                            <div if="${not articles.isEmpty()}">
                                <label for="articleSelected">Article</label>
                                <select name="articleSelected" id="articleSelected" >
                                    <!-- Shows all the articles created by the client not yet assigned to any auction -->
                                    <option each="article : ${articles}" value="${article.article_id}" text="${article.name}"></option>
                                </select><br/>
                                <button type="submit">Add to auction</button>
                            </div>
                            <div unless="${not articles.isEmpty()}">
                                <!-- Static version of the page -->
                                <p>First of all, create some new ARTICLES !</p>
                            </div>
                        </div>

                        <!-- Box that shows the client which articles he is adding to the auction during creation -->
                        <div style="flex: 1;" if="${!articlesSelected.isEmpty()} ">
                            <h2>List of Articles selected :</h2>
                            <table>
                                <thead>
                                <tr>
                                    <th>NAME</th>
                                    <th>CODE</th>
                                    <th>PRICE</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <!-- Table Content-->
                                </tbody>
                            </table>
                        </div>
                        <div style="flex: 1;" unless="${!articlesSelected.isEmpty()}">
                            <p>NO ARTICLES SELECTED !</p>
                        </div>
                    </div>
                </form>

                <!-- Form that triggers the doPost () of the CreateAuction servlet, takes as input all the attributes of an auction and creates it -->
                <form action="#" action="@{/CreateAuction}" method="post" enctype="multipart/form-data">
                    <div>
                        <label for="minimum_raise"> Minimum Raise:</label>
                        <input type="number" name="minimum_raise" id="minimum_raise" min="1" step="1" max="1000000" required>
                        <span> &euro;</span>
                    </div>
                    <div>
                        <label for="expiring_date">Expiring Date : </label>
                        <input type="datetime-local" name="expiring_date" id="expiring_date" min="${ldt}" placeholder="yyyy-MM-ddTHH:mm" value="${ldt}" required>
                    </div>

                    <!-- Necessary to keep hidden parameters that keep track of all the selected articles, so as not to make them available again in the selection -->
                    <input type="hidden"  each="article : ${articlesSelected}" value="${article.article_id}" name="articlesSelected" >
                    <button type="submit">Create Auction</button>
                </form>
            </div>
        </div>


        <!-- Page PURCHASE -->
        <div class="id_purchasePage">
            <div>

                <!-- SEARCH FORM -->
                <div class="row first-row form">
                    <h2>Search with a keyword</h2>
                    <form   action="#" method="GET">
                        <div>
                            <label for="key">Key:</label>
                            <input type="text" name="key" id="key" required>
                        </div>
                        <button id="id_searchButton"  type="submit">Search</button>
                    </form>
                </div>

                <!-- SEARCHED AUCTIONS -->
                <div id="availableAuctions"  class="row second-row auc-list" >
                    <h2 id="available-auc" text="Available auction for: "></h2>
                    <section class="scrollable">
                        <div id="id_searchedAuctions">
                            <!-- DYNAMIC SEARCHED AUCTIONS, clickable to AuctionDetails-->
                        </div>
                    </section>
                </div>

                <!-- WON OFFERS -->
                <div id="wonOffers"  class="row third-row offers-list">
                    <h2>Won Offers</h2>
                    <section class="scrollable scrll-table" if="${winningOffers} != null and not ${winningOffers.isEmpty()}">
                        <div each="auction : ${winningOffers.keySet()}">
                            <h3 text="'Maximum Offered for this auction &#x20AC; : '+ ${winningOffers.get(auction).getPrice()}" >Offerta massima </h3>
                            <table>
                                <thead>
                                <tr>
                                    <th class="tbl-name">Article name</th>
                                    <th class="tbl-code">Code</th>
                                    <th class="tbl-price">Price (&euro;)</th>
                                </tr>
                                </thead>
                                <tbody >
                                    <!--EACH ARTICLE CONTENT, for every AUCTION -->
                                </tbody>
                            </table>
                        </div>
                    </section>
                </div>
            </div>
        </div>

        <!-- Page AUCTIONDETAILS -->
        <div id="id_auctionDetails" >
            <div class="row first-row details">
                <h2 if="${auction == null}">INFORMATIONS</h2>
                <p if="${auction == null}">User did not create the auction or user does not exists</p>

                <!-- LIST OF ARTICLES -->
                <section if="${auction != null}">
                    <div >
                        <h2 id="dtl-articles">List of Articles contained by auction</h2>
                        <block if="${not article.isEmpty()}">
                            <table>
                                <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Code</th>
                                    <th>Image</th>
                                    <th>Description</th>
                                </tr>
                                </thead>
                                <tbody>
                                    <tr each="item : ${article}">
                                        <!-- Article Content-->
                                    </tr>
                                </tbody>
                            </table>
                        </block>
                        <p id="noArticleAvailable">Nessun articolo disponibile</p>
                        <!--INFO about auction-->
                        <p><strong>Prezzo iniziale: </strong> &euro;</p>
                        <p><strong>Rialzo minimo: </strong> &euro;</p>
                        <p><strong>Scadenza: </strong></p>
                    </div>

                    <div if="${!auction.isOpen() and awardedUser == null}">
                        <hr>
                        <h2 id="dtl-info">INFORMATIONS:</h2>
                        <p>No offers made for this article</p>
                        <!-- Add a button to close the auction -->
                    </div>

                    <div id=""if="${!auction.isOpen() and awardedUser != null}">
                        <hr>
                        <h2 id="dtl-infoAwarded">Winner informations</h2>
                        <p><strong>Name: </strong><span text="${awardedUser.username}">name 1</span></p>
                        <p><strong>Offer: </strong><span text="${#numbers.formatInteger(maxAuctionOffer.price,1,'POINT')}">Offer: offer 1</span> &euro;</p>
                        <p><strong>Address: </strong><span text="${awardedUser.address}">address 1</span></p>
                    </div>
                </section>
            </div>

            <!-- LIST OF OFFERS -->
            <div class="row second-row offers-list" remove="${auction == null or !auction.isOpen()} ? all">
                <section class="mid-col scrollable">
                    <h2 id="dtl-offers">OFFERS</h2>
                    <p if="${offers == null or offers.isEmpty()}">Non esiste alcuna offerta al momento!</p>
                    <table remove="${offers == null or offers.isEmpty()} ? all">
                        <thead>
                        <tr>
                            <th class="tbl-val tbl-name">Nome</th>
                            <th class="tbl-val tbl-offer">Offerta (&euro;)</th>
                            <th class="tbl-val tbl-date">Data</th>
                        </tr>
                        </thead>
                        <tbody>
                            <!-- LIST OF OFFERS-->
                        </tbody>
                    </table>
                    <a class="button-link" href="#" if="${details == 1 and !isExpired }" href="@{CloseAuction(auctionId= ${auction.auction_id})}">
                        <button>Close auction</button>
                    </a>

                </section>
            </div>
        </div>

        <!-- Page OFFER -->
        <div id="id_offer" >
            <div>

                <!-- INFO ABOUT AUCTION (articles etc) -->
                <div class="row first-row details">
                    <h2 if="${auction == null or isExpired}">Informations</h2>
                    <p if="${auction == null}">Selected auction does not exists</p>
                    <p if="${isExpired}">Auction for selected article is expired</p>
                    <section if="${auction != null and not isExpired}">
                        <div>
                            <h2>List of Articles contained by auction</h2>
                            <block th:if="${not article.isEmpty()}">
                                <table>
                                    <thead>
                                    <tr>
                                        <th>Name</th>
                                        <th>Code</th>
                                        <th>Image</th>
                                        <th>Description</th>
                                    </tr>
                                    </thead>
                                    <tbody>
                                        <!--TABLE BODY-->
                                    </tbody>
                                </table>
                            </block>
                            <p unless="${not article.isEmpty()}">Nessun articolo disponibile</p>
                            <!--INFO about auction(price, raise, expiring)-->
                        </div>
                    </section>
                </div>

                <!-- LIST OF OFFERS -->
                <div class="row second-row offers-list" if="${auction != null and not isExpired}">
                    <section class="mid-col scrollable" >
                        <h2 >OFFERS</h2>
                        <p if="${offers == null or offers.isEmpty()}">Non esiste alcuna offerta al momento!</p>
                        <table remove="${offers == null or offers.isEmpty()} ? all">
                            <thead>
                            <tr>
                                <th class="tbl-val tbl-name">Nome</th>
                                <th class="tbl-val tbl-offer">Offerta (&euro;)</th>
                                <th class="tbl-val tbl-date">Data</th>
                            </tr>
                            </thead>
                            <tbody>
                                <!-- LIST OF OFFERS-->
                            </tr>
                            </tbody>
                        </table>
                        <a class="button-link" href="#" if="${details == 1 and !isExpired }" href="@{CloseAuction(auctionId= ${auction.auction_id})}">
                            <button>Close auction</button>
                        </a>
                    </section>
                </div>

                <!-- FORM FOR OFFER -->
                <div id="offerForm"class="row third-row form" >
                    <h2>New Offer</h2>
                    <form action="#" action="@{/MakeOffer}" method="post">
                        <div>
                            <label for="offer">Value:</label>
                            <input type="number" name="offer" id="offer" min="1" max="2000000000" step="1" min="${min}" value="${min}" with="min=${not offers.isEmpty()} ? ${maxAuctionOffer.price + auction.minimum_raise} : ${auction.initial_price}" required>
                            <span>&euro;</span>
                            <input type="hidden" name="auctionId" value="${auction.auction_id}">
                        </div>
                        <button name="offer-submit" type="submit">Confirm</button>
                    </form>
                </div>
            </div>
        </div>

        <!-- NAVIGATION THROUGH PAGES-->
        <div class="col rgt-col">
            <div class="quick-nav menu">
                <h3>Menu</h3>
                <ul>
                    <a id="home_anchor"><li>Home</li></a>
                    <a id="purchase_anchor"><li>Purchase</li></a>
                    <a id="sell_anchor"><li>Sell</li></a>
                    <a id="logout_anchor"><li>Logout</li></a>
                </ul>
            </div>
        </div>
    </div>
</body>
</html>